var opflag=0; //左侧导航隐藏图标点击标记

//控制主体框宽度
function resetW(){
	var fxw;
	if(opflag==1)
	{
	fxw=document.documentElement.scrollWidth-5;
	}
	else
	{
    fxw=document.documentElement.scrollWidth-166;
	}
	document.getElementById("mbdif").style.width=fxw+'px';
}

//左边栏，导航选中时，样式变化效果
$(function(){
	    $.each($(".menu_wrap li"), function(){
			$(this).click(function(){
				if($(this).hasClass("title")) return;
				$(".menu_wrap li").not($(this)).removeClass("curr");
				$(this).addClass("curr");
			});
		});



	    
//隔行变色 
 $(".list_table tbody tr,.list-d-table tbody tr").addClass("odd");
 $(".list_table  tbody tr:even,.list-d-table tbody tr:even").addClass("even");
 
$(".list_table tbody tr,.list-d-table tbody tr").live("mouseover",function(){$(this).addClass("on")})
$(".list_table tbody tr,.list-d-table tbody tr").live("mouseout",function(){$(this).removeClass("on")}); 	
 
	$(".btn").mouseover(function(){
		$(this).removeClass('click').addClass('on');
	}).mouseout(function(){
		$(this).removeClass('on');
	});
	
	$(".search .txt a").click(function(event)
	{
		if($('#searchShow').hasClass('pop'))
		{
		$('#searchShow').attr('class', 'more');
		$(".search .txt a").html('关闭');
		}
		else
		{
		$('#searchShow').attr('class', 'pop');
		$(".search .txt a").html('高级搜索');
		}
		event.stopPropagation(); //取消事件冒
	});
	
	$("#searchShow").click(function(event)
	{
		event.stopPropagation(); //取消事件冒
	});
	
	//全选、反选
	$(".list_table #chkall").click(function()
	{
		$(".list_table input:checkbox").attr("checked",$(this).attr("checked"));
	});
	
	
	$(".sku span").click(function(){
		if($(this).hasClass("curr"))
		$(this).removeClass("curr");
		else
		$(this).addClass("curr");
	})

//设置表单元素样式
	$('.com_modi_table input[type=text],.com_modi_table input[type=password]').addClass('g-ipt');
	$('.com_modi_table select[type=single]').addClass('g-select');
	$('.toolbar input[type=text],.add_detail_box input[type=text]').addClass('inputtxt');
	$('.toolbar select,.add_detail_box select').addClass('selecttxt');
	
	
	
	$(".list_table tbody tr td input[type=checkbox]").click(function(){
		if($(this).attr("checked"))
		$(this).parent().parent().addClass("check");
		else
		$(this).parent().parent().removeClass("check");	
	})
	
	
	$(".list_table thead tr th input[type=checkbox],.checkall").click(function(){
		
		if($(this).attr("checked")){
			$(".checkall").attr("checked","true");
			$(".check-box").attr("checked","true");
			$(".check-box").parent().parent().addClass("check");
			$('.list_table tbody tr').addClass("check");
			}			
		else {
			$(".check-box").removeAttr("checked");
			$(".check-box").parent().parent().removeClass("check");
			$('.list_table tbody tr').removeClass("check");
			$(".checkall").removeAttr("checked");
			}							  							  
			})		  

		//单个checkbox选中背景变色
		$(".check-box").click(function(){	
		if($(this).attr("checked")){									   
		$(this).parent().parent().addClass("check");	
		}
		else {
		$(this).parent().parent().removeClass("check");	
		}
		});
	
	$('.tbox').css({'overflow':'auto'});
	$('.tbox .list_table').css({'white-space':'nowrap','word-break':'keep-all'});
	
	if($("#lframe").width()>150)
	{
		var w;
		if ($.browser.msie && ($.browser.version == "6.0") && !$.support.style || ($.browser.version == "7.0")) w=screen.width-64;
		else w=screen.width-48
	$('.tbox').width(w);
	$('.tbox .list_table').width(w);
	
	}
	else
	{
		$('.tbox .list_table').width(screen.width-220);
		$('.tbox').width(screen.width-220)
	}
	setTimeout(function(){$(".tbox").height($(".tbox").height()+10);},200);
    	
});


//点击空白区域隐藏高级搜索
$(document).click(function(event)
{
	$('#searchShow').attr('class', 'pop');
	$(".search .txt a").html('高级搜索');
	});

//ie自适应按钮宽度
$("a.btn").width($("a.btn").width());


/*返回*/
function goback() {
	history.back();
	}

/*跳转*/
function gotolink(url){
	location.href=url;
	}




//操作提示
function doinfo(msg,flag)
{
	var html="";
	if(flag==1)//成功信息
	{
		html="<div id='InfoDiv' class='sucess-info'>"+msg+"</div>"
	}
	if(flag==null || flag==0 || flag=="")//失败信息
	{
		html="<div id='InfoDiv' class='err-info'>"+msg+"</div>"
	}
	$("body").append(html);
	$('#InfoDiv').animate({top:parent.document.documentElement.scrollTop+5},10);
	$('#InfoDiv').fadeIn(500);
	setTimeout('outInfoDiv()',3000);
}

//退出操作提示
function outInfoDiv()
{
	$('#InfoDiv').fadeOut(500)
	setTimeout('delInfoDiv()',1000);
}
//移除操作提示
function delInfoDiv()
{
	$('#InfoDiv').remove()
	
}
//操作提示随滚动条滚动
$(window).scroll(function()
{	
	var div=parent.$("#mbdif").contents().find("#InfoDiv")
	$(div).animate({top:$(document).scrollTop()+5},10) 
});




//高级搜索控制
function controlDiv()
{
	if($(".advice").text()=="高级搜索")
	{
	$("#div-suppersear").show();
	$(".advice").html("普通搜索");
	$("#signSearch").val('1');
	}
	else
	{
	$("#div-suppersear").hide();
	$(".advice").html("高级搜索");
	$("#signSearch").val('');
	}
}

$(function(){
	if ($("#signSearch").val() == '1') {
		$("#div-suppersear").show();
		$(".advice").html("普通搜索");
		} else {
			$("#div-suppersear").hide();
			$(".advice").html("高级搜索");
		}
})

//关闭弹出的页面
function closepage()
{
window.opener=null;
window.open('','_self');
window.close();
}



$('.menu_wrap ul li ul li span.tree-title').live('click',function()
{
if(parent.$('#lframe').attr('src').split('?')[1].split('=')[1]=="root-12")
{
parent.window.scrollTo(0,0);
parent.$('#mbdif').hide();
parent.$('#load').show();
}
});


$('.page a').live('click',function(){
	if($(this).attr("href")=="undefined" ||$(this).attr("href")==null||$(this).attr("href")=="") return;
	loadListTable();
})

//列表加载等待
function loadListTable()
{
	try
	{
	var ah=$(".actiontr").height();
	if(ah==null ||ah=="") ah=0;
	var maskdiv=$('<div>');
	var maskload=$('<div>');
	var maskMtop=30+ah;
	$(maskdiv).css({'position':'absolute','background':'#fff','filter':'alpha(opacity=100)','opacity':'1','margin-top':''+maskMtop+'px'})
	var loadTop=$('.list_table').offset().top+$('.list_table').height()/2+10;
	var loadLeft=$('.list_table').offset().left+$('.list_table').width()/2+10;
	$(maskload).css({'position':'absolute','z-index':'1000','top':loadTop,'left':loadLeft,'width':'200px'})
	$(maskload).html('<img src=/mms/yougou/images/layout/blue-loading.gif /> 载入中，请稍后...');
	$(maskdiv).height($('.list_table').height()-10-ah)
	$(maskdiv).width($('.list_table').width()+10)
	$('.list_table').before(maskdiv).before(maskload);
	}catch(error){}
}


//表头分页事件
$(".page-head a").click(function(){
	
	var p=parseInt($(this).attr("page"));
	if(p==0) p=1;
	
	if($(this).hasClass("dis")) return;
	
	
	if($(this).hasClass("pre"))
	{
		p-=1;
	}
	
	if($(this).hasClass("next"))
	{
		p+=1;
	}
	loadListTable();
	queryPage(p);
	
})


//页面加载等待
function addLoadEvent(func) {
  var oldonload = window.onload;
  if (typeof window.onload != 'function') {
    window.onload = func;
  } else {
    window.onload = function() {
      if (oldonload) {
        oldonload();
      }
      func();
    }
  }
}

function overWeb() {
parent.$('#load').hide();
parent.$('#mbdif').show();
}
$(function(){
	addLoadEvent(overWeb);
	
	$('input[readonly="readonly"]').keydown(function(){
		if(event.keyCode == 8) 
			event.keyCode = 0;
	});
});

//导出等待
function doExportLoading(){
	openDiv({
		content:'正在导出，请稍候...</br><img src=/bms/yougou/images/icon/loading_bar.gif />',
		lock:true,
		width:260,
		height:120,
		closable:false
	});
}

(function() {
    String.prototype.format = function(args) {
        var result = this;
        if (arguments.length > 0) {
            if (arguments.length == 1 && typeof(args) == "object") {
                for (var key in args) {
                    if (args[key] != undefined) {
                        var reg = new RegExp("({" + key + "})", "g");
                        result = result.replace(reg, args[key]);
                    }
                }
            } else {
                for (var i = 0; i < arguments.length; i++) {
                    if (arguments[i] != undefined) {
                        var reg = new RegExp("({)" + i + "(})", "g");
                        result = result.replace(reg, arguments[i]);
                    }
                }
            }
        }
        return result;
    };

    String.prototype.len = function() {
        return this.replace('[^\x00-\xff]/g', 'aa').length;
    };
})();

//页面控件
(function($) {

    function YGUI(type) {
        this.version = '1.0';
        this.name = "YGUI";
        this.type = type;
    }

    window.YGUI = YGUI;

    //下拉框
    var dropdown = function(target) {
        this.target = target;
        this.data = [];
        YGUI.call(this, 'dropdown');
    };

    dropdown.prototype.init = function() {
        var that = this;
        with(that) {
            for (var i = 0; i < target.length; i++) {
                data.push({
                    text: target[i].text,
                    value: target[i].value
                });
            };
            render();
            triggerEvent();
        }
    };

    dropdown.prototype.render = function() {
        var ddbox = $('<span class="yg-dropdown"></span>'),
            list = [],
            $target = $(this.target),
            tclass = $target.attr('class');
        ddbox.addClass(tclass);
        $target.removeAttr('class');
        $.each(this.data, function(i, item) {
            list.push('<li value="{0}">{1}</li>'.format(item.value, item.text));
        });
        ddbox.append('<div class="yg-dropdown-s"></div><div class="yg-dropdown-title"><input type="text" class="yg-dropdown-val" readonly="readonly"/><i class="iconfont Gray yg-dropdown-ico">&#xe60d;</i></div><ul class="yg-dropdown-list hide">' + list.join('') + '</ul>')
        $target.wrap(ddbox);
    };

    dropdown.prototype.triggerEvent = function() {
        var $target = $(this.target),
            dropbox = $target.parents('.yg-dropdown'),
            ul = $('.yg-dropdown-list', dropbox),
            li = $('li', ul),
            yg_dropdown_title = $('.yg-dropdown-title', dropbox),
            input_val = $('.yg-dropdown-val', dropbox),
            display = ul.css("display");
        yg_dropdown_title.click(function(event) {
            ul.toggleClass('hide');
        });
        li.hover(function() {
            $(this).addClass('hover');
        }, function() {
            $(this).removeClass('hover');
        }).click(function(event) {
            var $this = $(this);
            ul.addClass('hide');
            if (input_val.data('value') != $this.attr('value')) {
                input_val.val($this.text()).data('value', $this.attr('value'));
                $('option', $target).eq($this.index()).prop('selected', true).click();
                $target.change();
            }
        });

        li.eq(0).click();

        // 滚动条的样式插件
        ul.niceScroll({
            cursorcolor: "#8fcbf2",
            cursoropacitymax: 1,
            touchbehavior: false,
            cursorwidth: "5px",
            cursorborder: "0",
            cursorborderradius: "5px"
        });
    }

    $.fn.dropdown = function(args) {
        return $(this).each(function(i, item) {
            var dd = new dropdown(item);
            dd.init();
            $(item).data('ui', dd);
        });
    }

   //排序样式设置
    var SORTOPT = {
            desc: true,
            asc: false
        },
        sortfilter = function(target) {
            this.target = target;
            this.data = SORTOPT.asc;
            YGUI.call(this, 'sort');
        };
    sortfilter.prototype.init = function() {
        var that = this;
        with(that) {
            render();
            triggerEvent();
        }
    };
    sortfilter.prototype.render = function() {
        var $target = $(this.target),
            tclass = $target.attr('class'),
            isflag = $target.attr('Nenabled'),
            sortbox = $('<span class="yg-sort"><span class="yg-sort-s"></span><span class="icon iconfont {0}"><i class="sort-up">&#xe603;</i><i class="sort-down Blue">&#xe604;</i></span>&nbsp;</span>'.format(isflag ? 'disabled': ''));
        sortbox.addClass(tclass);
        $target.wrap(sortbox);
    };
    sortfilter.prototype.triggerEvent = function() {
        var $target = $(this.target),
            sortbox = $target.parents('.yg-sort'),
            sort_icon = $('.icon', sortbox);
        if($target.attr('checked')){// Add on 2015-08-19
        	sort_icon.addClass('checked');
        }
        sortbox.mousedown(function() {
            if($target.attr('Nenabled')){
                $target.removeAttr('Nenabled');
                sort_icon.removeClass('disabled');
                $target[0].checked = true;
            }else{
                sort_icon.toggleClass('checked');
            }
        });

    };
    $.fn.Sort = function(args) {
        return $(this).each(function(i, item) {
            var sf = new sortfilter(item);
            sf.init();
            $(item).data('ui', sf);
        });
    }
	$(function() {
        $('[data-ui-type=dropdown]').dropdown().size();
        $('[data-ui-type=sort]').Sort();
    });
})(jQuery);

(function($){
	$.fn.scrollTo = function( target, options, callback ){
		  if(typeof options == 'function' && arguments.length == 2){ callback = options; options = target; }
		  var settings = $.extend({
		    scrollTarget  : target,
		    offsetTop     : 50,
		    duration      : 500,
		    easing        : 'swing'
		  }, options);
		  return this.each(function(){
		    var scrollPane = $(this);
		    var scrollTarget = (typeof settings.scrollTarget == "number") ? settings.scrollTarget : $(settings.scrollTarget);
		    var scrollY = (typeof scrollTarget == "number") ? scrollTarget : scrollTarget.offset().top + scrollPane.scrollTop() - parseInt(settings.offsetTop);
		    scrollPane.animate({scrollTop : scrollY }, parseInt(settings.duration), settings.easing, function(){
		      if (typeof callback == 'function') { callback.call(this); }
		    });
		  });
		}
})(jQuery);