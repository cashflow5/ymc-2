<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yougou.kaidian.user.dao.SupplierContractMapper" >
  <resultMap id="BaseResultMap" type="com.yougou.kaidian.user.model.pojo.SupplierContract" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="supplier_id" property="supplierId" jdbcType="VARCHAR" />
    <result column="contract_no" property="contractNo" jdbcType="VARCHAR" />
    <result column="clearing_form" property="clearingForm" jdbcType="INTEGER" />
    <result column="effective_date" property="effectiveDate" jdbcType="DATE" />
    <result column="failure_date" property="failureDate" jdbcType="DATE" />
    <result column="update_time" property="updateTime" jdbcType="VARCHAR" />
    <result column="update_user" property="updateUser" jdbcType="VARCHAR" />
    <result column="attachment" property="attachment" jdbcType="VARCHAR" />
  </resultMap>
 <resultMap id="supplierContractMap" type="com.yougou.kaidian.user.model.pojo.SupplierContract">
   <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="supplier_id" property="supplierId" jdbcType="VARCHAR" />
    <result column="contract_no" property="contractNo" jdbcType="VARCHAR" />
    <result column="clearing_form" property="clearingForm" jdbcType="SMALLINT" />
    <result column="effective_date" property="effectiveDate" jdbcType="DATE" />
    <result column="failure_date" property="failureDate" jdbcType="DATE" />
    <result column="update_time" property="updateTime" jdbcType="VARCHAR" />
    <result column="update_user" property="updateUser" jdbcType="VARCHAR" />
    <result column="attachment" property="attachment" jdbcType="VARCHAR" />
    <result column="declarant" property="declarant" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="bind_status" property="bindStatus" jdbcType="CHAR" />
    <result column="supplier" property="supplier" jdbcType="VARCHAR" />
    <result column="create_user" property="createUser" jdbcType="VARCHAR" />
    <result column="mark_remaining_days" property="markRemainingDays" jdbcType="INTEGER" />
    <result column="contract_remaining_days" property="contractRemainingDays" jdbcType="INTEGER" />
    <result column="is_Need_Renew" property="isNeedRenew" jdbcType="CHAR" />
    <result column="is_Use_ERP" property="isUseERP" jdbcType="CHAR" />
    <result column="is_Need_Deposit" property="isNeedDeposit" jdbcType="CHAR" />
    <result column="is_need_use_fee" property="isNeedUseFee" jdbcType="CHAR" />
    <result column="deposit" property="deposit" jdbcType="DECIMAL" />
    <result column="use_fee" property="useFee" jdbcType="DECIMAL" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="bank_owner" property="bankOwner" jdbcType="VARCHAR" />
    <result column="bank_account" property="bankAccount" jdbcType="VARCHAR" />
    <result column="bank_province" property="bankProvince" jdbcType="VARCHAR" />
    <result column="bank_city" property="bankCity" jdbcType="VARCHAR" />
    <result column="bank_area" property="bankArea" jdbcType="VARCHAR" />
    <result column="bank_name" property="bankName" jdbcType="VARCHAR" />
    <result column="parent_contract_id" property="parentContractId" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="CHAR" />
    <result column="pre_deposit" property="preDeposit" jdbcType="DECIMAL" />
    <result column="pre_useFee" property="preUsefee" jdbcType="DECIMAL" />
    <result column="is_Transfer_Deposit" property="isTransferDeposit" jdbcType="CHAR" />
    <result column="renew_flag" property="renewFlag" jdbcType="CHAR" />
    <result column="supplier_type" jdbcType="CHAR" property="supplierType" />
    <result column="supplier_code" jdbcType="CHAR" property="supplierCode" />
    <result column="is_old" jdbcType="CHAR" property="isOld" />
    <result column="deposit_status" property="depositStatus" jdbcType="CHAR" />
    <result column="use_fee_status" property="useFeeStatus" jdbcType="CHAR" />
	</resultMap>
	
	<!-- 附件 -->
	<resultMap id="supplierContractAttachmentMap" type="com.yougou.kaidian.user.model.pojo.SupplierContractAttachment">
		<result column="id" property="id" jdbcType="VARCHAR" />
		<result column="contract_id" property="contractId" jdbcType="VARCHAR" />
		<result column="attachment_name" property="attachmentName" jdbcType="VARCHAR" />
		<result column="attachment_real_name" property="attachmentRealName" jdbcType="VARCHAR" />
		<result column="attachment_type" property="attachmentType" jdbcType="VARCHAR" />
		<result column="supplier_id" property="supplierId" jdbcType="VARCHAR" />
		
	</resultMap>
	<!-- 商标 -->
	<resultMap id="supplierContractTrademarkMap" type="com.yougou.kaidian.user.model.pojo.SupplierContractTrademark">
		<result column="id" property="id" jdbcType="VARCHAR" />
		<result column="contract_id" property="contractId" jdbcType="VARCHAR" />
		<result column="trademark" property="trademark" jdbcType="VARCHAR" />
		<result column="authorizer" property="authorizer" jdbcType="VARCHAR" />
		<result column="type" property="type" jdbcType="VARCHAR" />
		<result column="registered_trademark" property="registeredTrademark" jdbcType="VARCHAR" />
		<result column="registered_start_date" property="registeredStartDate" jdbcType="VARCHAR" />
		<result column="registered_end_date" property="registeredEndDate" jdbcType="VARCHAR" />
	</resultMap>
	
	<!-- 商标明细 -->
	<resultMap id="supplierContractTrademarkSubMap" type="com.yougou.kaidian.user.model.pojo.SupplierContractTrademarkSub">
		<result column="id" property="id" jdbcType="VARCHAR" />
		<result column="trademark_id" property="trademarkId" jdbcType="VARCHAR" />
		<result column="be_authorizer" property="beAuthorizer" jdbcType="VARCHAR" />
		<result column="level" property="level" jdbcType="VARCHAR" />
		<result column="authoriz_startdate" property="authorizStartdate" jdbcType="VARCHAR" />
		<result column="authoriz_enddate" property="authorizEnddate" jdbcType="VARCHAR" />
	</resultMap>
	
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, supplier_id, contract_no, clearing_form, effective_date,failure_date,update_time,update_user,attachment
  </sql>

  <select id="getSupplierContractList" parameterType="java.lang.String"  resultType="map">
    SELECT t1.contract_no,t2.is_valid,t1.clearing_form,t1.effective_date,t1.failure_date,t1.id,t1.attachment FROM tbl_sp_supplier_contract t1 
	INNER JOIN tbl_sp_supplier t2 ON(t1.supplier_id=t2.id)
    where t1.supplier_id = #{value} order By t1.update_time desc
  </select>
  <!-- 总记录数 -->
	<select id="getContractCounts" parameterType="java.lang.String" resultType="int">
		  select count(1) from tbl_sp_supplier_contract where supplier_id = #{supplierId} 
	</select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from tbl_sp_supplier_contract
    where id = #{id,jdbcType=VARCHAR}
  </delete>
    <!-- 根据供应商ID查询当前合同-->
	<select id="getCurrentContractBySupplierId" resultMap="supplierContractMap">
		select t.*  
		from tbl_sp_supplier_contract t
		where t.supplier_id = #{supplierId,jdbcType=VARCHAR} and t.renew_flag in ('1','2')
	</select>
	
	<select id="selectSupplierContractAttachmentByContractId" resultMap="supplierContractAttachmentMap">
		select * from tbl_sp_supplier_contract_attachment where contract_id = #{contractId,jdbcType=VARCHAR}
	</select>
	
	<select id="selectSupplierContractTrademark" resultMap="supplierContractTrademarkMap">
		select * from tbl_sp_supplier_contract_trademark where contract_id = #{contractId,jdbcType=VARCHAR}
	</select>
	
	<select id="selectSupplierContractTrademarkSubByTrademarkId" resultMap="supplierContractTrademarkSubMap">
		select * from tbl_sp_supplier_contract_trademark_sub where trademark_id = #{trademarkId,jdbcType=VARCHAR} order by level
	</select>
	
	<select id="selectSupplierContractById" resultMap="supplierContractMap">
		select t.*,s.supplier_code 
		from tbl_sp_supplier_contract t left join tbl_sp_supplier s on s.id = t.supplier_id
		where t.id = #{id,jdbcType=VARCHAR}
	</select>
</mapper>